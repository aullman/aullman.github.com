/*!
 *  opentok-layout-js (http://github.com/aullman/opentok-layout-js)
 *  
 *  Automatic layout of video elements (publisher and subscriber) minimising 
 *  white-space for the OpenTok on WebRTC API.
 *
 *  @Author: Adam Ullman (http://github.com/aullman)
 *  @Copyright (c) 2014 Adam Ullman
 *  @License: Released under the MIT license (http://opensource.org/licenses/MIT)
**/
!function(){var t=function(t,i,e,o,a,r){var n={left:i+"px",top:e+"px",width:o+"px",height:a+"px"},g=function(){var i=t.querySelector(".OT_root");if(i){var e=i.style.width;i.style.width=o+"px",i.style.width=e||""}};r&&$?($(t).stop(),$(t).animate(n,r.duration||200,r.easing||"swing",function(){g(),r.complete&&r.complete.call(this)})):OT.$.css(t,n),g()},i=function(t,i){var e=OT.$.css(t,i);return e?parseInt(e,10):0},e=function(t){var i=OT.$.height(t);return i?parseInt(i,10):0},o=function(t){var i=OT.$.width(t);return i?parseInt(i,10):0},a=function(e,o,a,r,n,g,d,l,h){var s,u=e.length,f=function(t,i){for(var e,r,n,g,d,l,h,f=1;u>=f;f++){var b=f,R=Math.ceil(u/b);h=Math.floor(a/R),l=Math.floor(o/b),tRatio=h/l,tRatio>i?(tRatio=i,h=l*tRatio):t>tRatio&&(tRatio=t,l=h/tRatio);var c=l*h*u;(void 0===e||c>e)&&(e=c,g=h,d=l,r=b,n=R)}return{maxArea:e,targetCols:r,targetRows:n,targetHeight:g,targetWidth:d,ratio:s}};if(g){var b=e.length>0&&e[0].querySelector("video");s=b&&b.videoHeight&&b.videoWidth?f(b.videoHeight/b.videoWidth,b.videoHeight/b.videoWidth):f(.75,.75)}else s=f(d,l);for(var R=s.targetRows*s.targetCols-u,c=R*s.targetWidth/2,v=(s.targetRows-1)*s.targetCols,p=(a-s.targetRows*s.targetHeight)/2,m=(o-s.targetCols*s.targetWidth)/2,T=0,y=0,x=0;x<e.length;x++){var O=e[x];x%s.targetCols===0?(T=m,x==v&&(T+=c),y+=0===x?p:s.targetHeight):T+=s.targetWidth,OT.$.css(O,"position","absolute");var M=s.targetWidth-i(O,"paddingLeft")-i(O,"paddingRight")-i(O,"marginLeft")-i(O,"marginRight")-i(O,"borderLeft")-i(O,"borderRight"),$=s.targetHeight-i(O,"paddingTop")-i(O,"paddingBottom")-i(O,"marginTop")-i(O,"marginBottom")-i(O,"borderTop")-i(O,"borderBottom");t(O,T+r,y+n,M,$,h)}},r=function(t){return"none"!==OT.$.css(t,"display")},n=function(t,n){if("none"!==OT.$.css(t,"display")){var g=t.getAttribute("id");g||(g="OT_"+OT.$.uuid(),t.setAttribute("id",g));var d=e(t)-i(t,"borderTop")-i(t,"borderBottom"),l=o(t)-i(t,"borderLeft")-i(t,"borderRight"),h=d/l,s=0,u=0,f=Array.prototype.filter.call(t.querySelectorAll("#"+g+">."+n.bigClass),r),b=Array.prototype.filter.call(t.querySelectorAll("#"+g+">*:not(."+n.bigClass+")"),r);if(f.length>0&&b.length>0){var R=f[0].querySelector("video");bigRatio=R&&R.videoHeight&&R.videoWidth?R.videoHeight/R.videoWidth:.75;var c,v;h>bigRatio?(c=l,v=Math.min(Math.floor(d*n.bigPercentage),l*bigRatio),u=v):(v=d,c=Math.min(l*n.bigPercentage,Math.floor(v/bigRatio)),s=c),a(f,c,v,0,0,n.bigFixedRatio,n.bigMinRatio,n.bigMaxRatio,n.animate)}else f.length>0&&0===b.length&&a(f,l,d,0,0,n.bigFixedRatio,n.bigMinRatio,n.bigMaxRatio,n.animate);a(b,l-s,d-u,s,u,n.fixedRatio,n.minRatio,n.maxRatio,n.animate)}};if(!TB)throw new Error("You must include the OpenTok for WebRTC JS API before the layout-container library");TB.initLayoutContainer=function(t,i){return i=OT.$.defaults(i||{},{maxRatio:1.5,minRatio:9/16,fixedRatio:!1,animate:!1,bigClass:"OT_big",bigPercentage:.8,bigFixedRatio:!1,bigMaxRatio:1.5,bigMinRatio:9/16}),t="string"==typeof t?OT.$(t):t,OT.onLoad(function(){n(t,i)}),{layout:n.bind(null,t,i)}}}();